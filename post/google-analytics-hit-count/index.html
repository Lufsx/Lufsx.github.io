<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="x-dns-prefetch-control" content="on"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,maximum-scale=5,viewport-fit=cover"><meta name="renderer" content="webkit"><title>ä»¥ Google Analytics å®ç°çš„ PV æµè§ˆé‡ç»Ÿè®¡ | Lufs&#39;s Blog</title><link rel="icon" type="image&#x2F;ico" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.1/favicon/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.1/favicon/apple-touch-icon.png"><link rel="icon" typt="image&#x2F;png" sizes="192x192" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.1/favicon/android-chrome-192x192.png"><link rel="icon" typt="image&#x2F;png" sizes="32x32" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.1/favicon/favicon-32x32.png"><link rel="icon" typt="image&#x2F;png" sizes="16x16" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.1/favicon/favicon-16x16.png"><link rel="mask-icon" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.1/favicon/safari-pinned-tab.svg" color="rgba(241,249,250,1)"><meta name="theme-color" content="rgba(241,249,250,1)"><link rel="stylesheet" href="/lib/spectre/spectre.min.css"><style>body{background-color:#f1f9fa}a,a:visited{color:#8f82bc}a:active,a:focus,a:hover{color:#8f82bc;opacity:.75}#post-content a,#post-content a:focus,#post-content a:hover,#post-content a:visited{color:#8f82bc;opacity:1}#post-content img.lazy{transition:filter .35s ease 0s}#post-content img.lazy:not(.loaded){visibility:hidden;-webkit-filter:blur(5px);filter:blur(5px)}#post-content img.lazy:not(.loaded):not(.loading){padding-bottom:68%}#post-content img.lazy.error{display:none}.post-entry .card-body a{color:#7065a3}.avatar{background:#7065a3}.navbar-link,.navbar-link:visited,.timeline .timeline-item .timeline-icon.icon-lg{color:#7065a3}.navbar-link:hover{color:#7065a3;opacity:.8}#disqus-loadmore-button,#disqus-switch-to-direct,#disqus_click_btn,#search-input .btn{background:#7065a3;border-color:#7065a3;color:#fff}#post-toc a.post-toc-link,#post-toc a.post-toc-link:visited,.share-menu.menu .menu-item>a{color:#7065a3}.share-menu.menu .menu-item>a:focus,.share-menu.menu .menu-item>a:hover,.share-menu.menu .menu-item>a:visited{color:#50596c;background:#f1f9fa;opacity:.85}</style><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.4/file/disqusjs.min.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.4/file/disqusjs.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.8/file/atom-one.min.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.8/file/atom-one.min.css"></noscript><script>!function(n){"use strict";n.loadCSS||(n.loadCSS=function(){});var t,o=loadCSS.relpreload={};o.support=function(){var e;try{e=n.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),o.bindMediaToggle=function(t){var e=t.media||"all";function a(){t.addEventListener?t.removeEventListener("load",a):t.attachEvent&&t.detachEvent("onload",a),t.setAttribute("onload",null),t.media=e}t.addEventListener?t.addEventListener("load",a):t.attachEvent&&t.attachEvent("onload",a),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(a,3e3)},o.poly=function(){if(!o.support())for(var t=n.document.getElementsByTagName("link"),e=0;e<t.length;e++){var a=t[e];"preload"!==a.rel||"style"!==a.getAttribute("as")||a.getAttribute("data-loadcss")||(a.setAttribute("data-loadcss",!0),o.bindMediaToggle(a))}},o.support()||(o.poly(),t=n.setInterval(o.poly,500),n.addEventListener?n.addEventListener("load",function(){o.poly(),n.clearInterval(t)}):n.attachEvent&&n.attachEvent("onload",function(){o.poly(),n.clearInterval(t)})),"undefined"!=typeof exports?exports.loadCSS=loadCSS:n.loadCSS=loadCSS}("undefined"!=typeof global?global:this)</script><meta name="google-site-verification" content="wk686q2aTrts7GR0yVJ7UrALaAodD62StMuSuH7dMOU"><meta name="mobile-web-app-capable" content="yes"><meta name="application-name" content="Lufs's Blog"><meta name="msapplication-starturl" content="https://blog.isteed.cc"><meta name="msapplication-navbutton-color" content="rgba(241,249,250,1)"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Lufs's Blog"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="search" type="application/opensearchdescription+xml" href="/source/opensearch.xml" title="Lufs's Blog"><meta property="og:title" content="ä»¥ Google Analytics å®ç°çš„ PV æµè§ˆé‡ç»Ÿè®¡ | Lufs&#39;s Blog"><meta property="og:site_name" content="Lufs&#39;s Blog"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.isteed.cc/post/google-analytics-hit-count/"><meta property="og:locale" content="zh-CN"><meta name="description" content="æµè§ˆé‡ç»Ÿè®¡æœ‰æŒºå¤šç§çš„ï¼Œä¸ä¹åƒä¸è’œå­ã€LeanCloud ç­‰ç»Ÿè®¡æ–¹å¼ï¼Œä½†å§‹ç»ˆä¸èƒ½å¦‚æ„ã€‚ ä¾‹å¦‚ä¸è’œå­æ— æ³•å¯¼å…¥&#x2F;ä¿®æ”¹æ•°æ®ï¼Œæµè§ˆé‡æ˜¯é€šè¿‡ href æ¥ç»Ÿè®¡çš„ï¼Œå¯¹ã€Œé•œåƒç«™ã€çš„ä¸å‹å¥½ï¼Œä»¥åŠ Safari ä¸Šçš„æŠ½é£â€¦ åˆåƒ LeanCloud çš„å“ªéº»çƒ¦çš„è®¾ç½®ä¸ã€Œç¼“æ…¢ã€çš„ APIâ€¦ - Lufs - Lufs&#39;s Blog"><meta name="keywords" content="Google Analytics, Blog, Page View, Vercel, Lufs, Lufs Blog, Hexo, hexo, Android, blog, æ°´æ€ª"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/google-analytics-hit-count/thumbnail.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/google-analytics-hit-count/t01p.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/google-analytics-hit-count/t02p.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/google-analytics-hit-count/t03p.png"><meta property="og:image" content="https://i.loli.net/2020/06/25/VIWUvCqSyX23jed.png"><meta property="article:published_time" content="2020-06-26T17:06:57.000Z"><meta property="article:modified_time" content="2020-07-16T08:53:57.000Z"><meta property="og:updated_time" content="2020-07-16T08:53:57.000Z"><meta property="article:author" content="Lufs"><meta property="article:tag" content="Google Analytics, Blog, Page View, Vercel, Lufs, Lufs Blog, Hexo, hexo, Android, blog, æ°´æ€ª"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/google-analytics-hit-count/thumbnail.png"><link rel="canonical" href="https://blog.isteed.cc/post/google-analytics-hit-count/"><meta name="generator" content="Hexo 5.4.0"><script>window.ga_tid="UA-139861604-1",window.ga_api="https://cfga.lufs.workers.dev"</script><script async>!function(e,n,a){function r(t){return isNaN(t)||t==1/0||t<0?void 0:t}function o(t){return Math.random().toString(36).slice(-t)}function i(t){return Math.ceil(Math.random()*(t-1))+1}var d=e.screen,c=encodeURIComponent,g=Math.max,t=e.performance,m=t&&t.timing;function s(){var t=[o(i(4))+"="+o(i(6)),"ga="+e.ga_tid,"dt="+c(n.title),"de="+c(n.characterSet||n.charset),"dr="+c(n.referrer),"ul="+(a.language||a.browserLanguage||a.userLanguage),"sd="+d.colorDepth+"-bit","sr="+d.width+"x"+d.height,"vp="+g(n.documentElement.clientWidth,e.innerWidth||0)+"x"+g(n.documentElement.clientHeight,e.innerHeight||0),"plt="+r(m.loadEventStart-m.navigationStart||0),"dns="+r(m.domainLookupEnd-m.domainLookupStart||0),"pdt="+r(m.responseEnd-m.responseStart||0),"rrt="+r(m.redirectEnd-m.redirectStart||0),"tcp="+r(m.connectEnd-m.connectStart||0),"srt="+r(m.responseStart-m.requestStart||0),"dit="+r(m.domInteractive-m.domLoading||0),"clt="+r(m.domContentLoadedEventStart-m.navigationStart||0),"z="+Date.now()];e.__ga_img=new Image,e.__ga_img.src=e.ga_api+"?"+t.join("&")}e.cfga=s,"complete"===n.readyState?s():e.addEventListener("load",s)}(window,document,navigator)</script><script type="application/ld+json">{
    "@context": "http://schema.org",
    "url": "https://blog.isteed.cc/post/google-analytics-hit-count/",
    "@type": "BlogPosting",
    "logo": "https://cdn.jsdelivr.net/gh/lufsx/res@0.1.1/favicon/android-chrome-192x192.png",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://blog.isteed.cc/post/google-analytics-hit-count/"
    },
    "headline": "ä»¥ Google Analytics å®ç°çš„ PV æµè§ˆé‡ç»Ÿè®¡ | Lufs&#39;s Blog",
    
    "image": {
        "@type": "ImageObject",
        "url": "https://cdn.jsdelivr.net/gh/lufsx/res@master/img/google-analytics-hit-count/thumbnail.png"
    },
    
    "datePublished": "2020-06-26T17:06:57.000Z",
    "dateModified": "2020-07-16T08:53:57.000Z",
    "author": {
        "@type": "Person",
        "name": "Lufs",
        "image": {
            "@type": "ImageObject",
            "url": "https://cdn.jsdelivr.net/gh/lufsx/res@0.1.1/avatar/avatar-36x36.png"
        },
        "description": "Life feeds on negative entropy."
    },
    "publisher": {
        "@type": "Organization",
        "name": "Lufs&#39;s Blog",
        "logo": {
            "@type": "ImageObject",
            "url": "https://cdn.jsdelivr.net/gh/lufsx/res@0.1.1/favicon/android-chrome-192x192.png"
        }
    },
    
    "potentialAction": {
        "@type": "SearchAction",
        "target": "https://blog.isteed.cc/search?s={search_term_string}",
        "query-input": "required name=search_term_string"
    },
    
    "keywords": "Google Analytics, Blog, Page View, Vercel, Lufs, Lufs Blog, Hexo, hexo, Android, blog, æ°´æ€ª",
    "description": "æµè§ˆé‡ç»Ÿè®¡æœ‰æŒºå¤šç§çš„ï¼Œä¸ä¹åƒä¸è’œå­ã€LeanCloud ç­‰ç»Ÿè®¡æ–¹å¼ï¼Œä½†å§‹ç»ˆä¸èƒ½å¦‚æ„ã€‚ ä¾‹å¦‚ä¸è’œå­æ— æ³•å¯¼å…¥/ä¿®æ”¹æ•°æ®ï¼Œæµè§ˆé‡æ˜¯é€šè¿‡ href æ¥ç»Ÿè®¡çš„ï¼Œå¯¹ã€Œé•œåƒç«™ã€çš„ä¸å‹å¥½ï¼Œä»¥åŠ Safari ä¸Šçš„æŠ½é£â€¦ åˆåƒ LeanCloud çš„å“ªéº»çƒ¦çš„è®¾ç½®ä¸ã€Œç¼“æ…¢ã€çš„ APIâ€¦ - Lufs - Lufs&#39;s Blog"
}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.9/file/dark.min.css" media="(prefers-color-scheme:dark)" crossorigin><script>"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js").then(function(e){console.log("Yay! ServiceWorker is loaded ğŸ‰")},function(e){console.log("Oh! ServiceWorker registration failed ğŸ˜¥")})})</script><script>console.log("\n %c Lufs's Blog %c https://blog.isteed.cc/ \n","color: #fff; background: #7065a3; padding:5px 0;","background: #f0fafb; padding:5px 0;"),console.log("%c ","background:url(https://cdn.jsdelivr.net/gh/lufsx/res@0.2.5/file/background.png) no-repeat center;background-size:200px;padding-left:200px;padding-bottom:162px;overflow:hidden;border-radius:10px;margin:5px 0")</script><script async src="https://cdn.splitbee.io/sb.js"></script><script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{token:" e4aef4b9b850426b92d9dad86089c719}></script><link rel="alternate" href="/atom.xml" title="Lufs's Blog" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="Lufs's Blog" type="application/rss+xml"></head><body><header><h1 class="header-title text-center"><a href="/">Lufs&#39;s Blog</a></h1><p class="text-center header-slogan">Life feeds on negative entropy.</p><nav class="navbar-section text-center"><a href="/" class="navbar-link">é¦–é¡µ</a> <a href="/archives/" class="navbar-link">å½’æ¡£</a> <a href="/search" class="navbar-link">æœç´¢</a> <a href="/welfare/" class="navbar-link">ç¦åˆ©</a> <a href="/post/about/" class="navbar-link">å…³äº</a> <a href="/links/" class="navbar-link">å‹é“¾</a></nav></header><div class="post-container"><div id="post-card" class="card"><div class="card-image lazy" crossorigin data-bg="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/google-analytics-hit-count/thumbnail.png"></div><div class="card-item-container"><div class="card-inner-cell"><div class="card-header"><h1 class="card-title h3 mb-2">ä»¥ Google Analytics å®ç°çš„ PV æµè§ˆé‡ç»Ÿè®¡</h1><div class="post-header-info"><p class="post-header-info-left text-gray"><img class="author-thumb lazy" data-src="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.1/avatar/avatar-36x36.png" src="/img/suka-lazyload.gif" alt="Lufs's Avatar"> <span>2020-06-27</span> <span class="suka-devide-dot"></span> <a class="category-link" href="/categories/%E5%88%86%E4%BA%AB/">åˆ†äº«</a><span id="post-meta-views" hidden><span class="suka-devide-dot"></span> <span></span> <span id="pv-counter">loading</span> <span>Views</span></span></p><div class="post-header-info-right"><div class="dropdown dropdown-right"><a class="dropdown-toggle" tabindex="0">åˆ†äº«æœ¬æ–‡</a><ul class="menu share-menu"><li class="menu-item"><a href="http://service.weibo.com/share/share.php?appkey=&title=ä»¥ Google Analytics å®ç°çš„ PV æµè§ˆé‡ç»Ÿè®¡&url=https://blog.isteed.cc/post/google-analytics-hit-count/&pic=https://cdn.jsdelivr.net/gh/lufsx/res@master/img/google-analytics-hit-count/thumbnail.png&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">åˆ†äº«åˆ°å¾®åš</a></li><li class="menu-item"><a href="http://connect.qq.com/widget/shareqq/index.html?site=Lufs's Blog&title=Lufs's Blog&summary=Life feeds on negative entropy.&pics=https://cdn.jsdelivr.net/gh/lufsx/res@master/img/google-analytics-hit-count/thumbnail.png&url=https://blog.isteed.cc/post/google-analytics-hit-count/" target="_blank" rel="external noopener noreferrer nofollow">åˆ†äº«åˆ° QQ</a></li><li class="menu-item"><a href="https://t.me/share/url?url=https://blog.isteed.cc/post/google-analytics-hit-count/&text=Lufs's Blog" target="_blank" rel="external noopener noreferrer nofollow">åˆ†äº«åˆ° Telegram</a></li><li class="menu-item"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJQAAACUCAAAAABQV18IAAABz0lEQVR42u3aMZLDMAxDUd//0rttdkcCPjMuLBhuMkkc6xWMJJK6fh54XUUVVVRRC9Qlrt09fx5kfjcap6gY1DLoAIp89v9VjlNUFEo9bBW86j4V9LtxinofahWoKojp84p6J2o6ma7eF/U+lApiuglcwUYLf1ExKDXona+3ZTNFPRpliw5wciXJ6W1Vl6IejVKB6O7ZLcQ00IvKRalFlCzGuz/CbqFGm7yijkURgJsg3YaOFE6KykLJG82gamIlhY+i8lCkSOYSCQciE2pROajdZLcrlNEiiGsQ2GS0qGNRpClNFm432brmZVF5KAUhGLJRtPiiIlDTggQp1rqGty3uF3U0ihzEspMeWMC/qroUdSSKJJkkmEkCa4O+qAgULX65QqvaNLpGZFFZKNp0dJtCilObyqIyULTBSDdwCqMm6aJyUWpTJoMUHlaVyWxRUSha8KJJ5zeHJorKRNHGj0JPD1oUlYUiBwVVA2g8sEpui4pA0UM3tIhGGpKjAkdRR6JIUkogtJg/WpCLOhZFm0Bu0Enzsqj3oshG0BVISNJa1HtQk0IFwW0X/KKiUKpZ5BqK7jvSHC8qCzUtzJMG0CQxLSoL9aSrqKKKKurj+gUZEdLCkUTjFAAAAABJRU5ErkJggg==" alt="QRCode"></li></ul></div></div></div></div><div class="card-body"><div id="post-toc"><ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%BC%80%E5%90%AF-Google-Analytics-API"><span class="post-toc-number">1.</span> <span class="post-toc-text">å¼€å¯ Google Analytics API</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E9%83%A8%E7%BD%B2%E5%88%B0-Vercel"><span class="post-toc-number">2.</span> <span class="post-toc-text">éƒ¨ç½²åˆ° Vercel</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%BF%AE%E6%94%B9-config-ts-%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">ä¿®æ”¹ config.ts çš„é…ç½®</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%AF%BC%E5%85%A5-Vercel"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">å¯¼å…¥ Vercel</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%B0%83%E7%94%A8-API"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">è°ƒç”¨ API</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E9%9B%86%E6%88%90%E5%88%B0-Hexo-%E4%B8%BB%E9%A2%98"><span class="post-toc-number">3.</span> <span class="post-toc-text">é›†æˆåˆ° Hexo ä¸»é¢˜</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%88%9B%E5%BB%BA-EJS"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">åˆ›å»º EJS</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%BC%95%E5%85%A5-EJS"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">å¼•å…¥ EJS</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%A0%B8%E5%BF%83-js"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">æ ¸å¿ƒ js</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%88%90%E6%9E%9C"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">æˆæœ</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E7%A2%8E%E7%A2%8E%E5%BF%B5"><span class="post-toc-number">4.</span> <span class="post-toc-text">ç¢ç¢å¿µ</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5-%E5%85%B3%E8%81%94%E9%98%85%E8%AF%BB"><span class="post-toc-number">5.</span> <span class="post-toc-text">å‚è€ƒé“¾æ¥&#x2F;å…³è”é˜…è¯»</span></a></li></ol></div><article id="post-content"><p>æµè§ˆé‡ç»Ÿè®¡æœ‰æŒºå¤šç§çš„ï¼Œä¸ä¹åƒä¸è’œå­ã€LeanCloud ç­‰ç»Ÿè®¡æ–¹å¼ï¼Œä½†å§‹ç»ˆä¸èƒ½å¦‚æ„ã€‚</p><p>ä¾‹å¦‚ä¸è’œå­æ— æ³•å¯¼å…¥/ä¿®æ”¹æ•°æ®ï¼Œæµè§ˆé‡æ˜¯é€šè¿‡ href æ¥ç»Ÿè®¡çš„ï¼Œå¯¹ã€Œé•œåƒç«™ã€çš„ä¸å‹å¥½ï¼Œä»¥åŠ Safari ä¸Šçš„æŠ½é£â€¦</p><p>åˆåƒ LeanCloud çš„å“ªéº»çƒ¦çš„è®¾ç½®ä¸ã€Œç¼“æ…¢ã€çš„ APIâ€¦</p><span id="more"></span><p>æœ€ç»ˆéƒ½è®©æˆ‘æ”¾å¼ƒï¼Œå¶ç„¶åœ¨ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://printempw.github.io/google-analytics-api-page-views-counter/">PRIN BLOG</a> å‘ç°å¯ä»¥åˆ©ç”¨ Google Analytics çš„æ•°æ®æ¥è¿›è¡Œæµè§ˆé‡ï¼Œä½†éœ€è¦éƒ¨ç½²åœ¨ VPS ä¸Šï¼Œè§ä½œè€…è¯´éƒ¨ç½²åˆ° Serverless å¹³å°å¤±è´¥ï¼Œå°±ä»¥ä¸ºæ— æ³•ç™½å«–ï¼Œç›´åˆ° <a target="_blank" rel="noopener external nofollow noreferrer" href="https://spencerwoo.com/">Spencer</a> çš„<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.spencerwoo.com/2020/06/serverless-ga-hit-count-api/">è¿™ç¯‡åšæ–‡</a>å‡ºæ¥ã€‚äºŒè¯ä¸è¯´ï¼Œå¼€æ ğŸ˜‹ï¼</p><hr><p>è¯¦ç»†æ•™ç¨‹å¯ä»¥çœ‹<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.spencerwoo.com/2020/06/serverless-ga-hit-count-api/">è¿™ç¯‡åšæ–‡</a>ï¼Œè¿™é‡Œå°±ç®€å•å¤è¿°ä¸€ä¸‹å‘¢</p><h1 id="å¼€å¯-Google-Analytics-API">å¼€å¯ Google Analytics API</h1><p>å¯ä»¥æŒ‰ç…§ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://developers.google.com/analytics/devguides/reporting/core/v4/quickstart/service-py#1_enable_the_api">Google å®˜æ–¹æ•™ç¨‹</a> èµ°ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æŒ‰ä¸‹é¢çš„æ­¥éª¤æ¥ã€‚</p><hr><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://console.developers.google.com/start/api?id=analyticsreporting.googleapis.com&amp;credential=client_key">setup tools</a> å¹¶æ ¹æ®æç¤ºè¿›è¡Œè®¾ç½®ï¼Œé€‰æ‹©ä¸€ä¸ªé¡¹ç›®ï¼ˆæˆ–åˆ›å»ºæ–°çš„é¡¹ç›®ï¼Œæ¯”å¦‚ ga-hit-countï¼‰ï¼Œä¹‹åä¸€è·¯ç»§ç»­ï¼Œå°±å¯ä»¥ä¸ºæˆ‘ä»¬è¿™ä¸€é¡¹ç›®å¼€å¯ Google API å’¯ï½</p><p><img src="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/google-analytics-hit-count/t01p.png" class="lazy" data-srcset="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/google-analytics-hit-count/t01p.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAABlBMVEXMzMyWlpYU2uzLAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAACklEQVQImWNgAAAAAgAB9HFkpgAAAABJRU5ErkJggg==" alt="Credentials"></p><p>ç„¶åé¡µé¢å°±ä¼šè·³è½¬åˆ° Google API çš„å‡­æ®è®¾ç½®é¡µé¢ï¼ŒAPI é€‰æ‹© <code>Analytics Reporting API</code>ï¼Œè°ƒç”¨æ–¹æ³•é€‰æ‹© <code>ç½‘é¡µæœåŠ¡å™¨</code>ï¼Œæœ€åé€‰æ‹© <code>ä¸ä¼šä½¿ç”¨ App Engine æˆ– Compute Engine</code> å³å¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/google-analytics-hit-count/t02p.png" class="lazy" data-srcset="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/google-analytics-hit-count/t02p.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAABlBMVEXMzMyWlpYU2uzLAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAACklEQVQImWNgAAAAAgAB9HFkpgAAAABJRU5ErkJggg==" alt="GetCredentials"></p><p>æœ€åæ ¹æ®æç¤ºè®¾ç½®åŸºæœ¬ä¿¡æ¯ï¼Œä¾‹å¦‚è®¾ç½®æœåŠ¡è´¦å·åç§°ï¼ˆéšæ„è®¾ç½®ï¼‰ï¼Œé€‰å®šã€Œè§’è‰²ã€ä¸º <code>Service Account User</code>ï¼ŒæŒ‰ç»§ç»­åå°±å°†ä¼šæœ‰ä¸€ä¸ª json æ–‡ä»¶ä¸‹è½½ä¸‹æ¥</p><p><img src="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/google-analytics-hit-count/t03p.png" class="lazy" data-srcset="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/google-analytics-hit-count/t03p.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAABlBMVEXMzMyWlpYU2uzLAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAACklEQVQImWNgAAAAAgAB9HFkpgAAAABJRU5ErkJggg==" alt="GoogleAPIs"></p><p>json æ–‡ä»¶é•¿è¿™æ ·ï¼Œéœ€è¦çš„å‡ ä¸ªä¿¡æ¯éƒ½åœ¨è¿™å„¿äº†</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">&quot;project_id&quot;</span>: <span class="string">&quot;gmeta-domain&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;private_key&quot;</span>: <span class="string">&quot;-----BEGIN PRIVATE KEY-----\nxxx-----END PRIVATE KEY-----\n&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;client_email&quot;</span>: <span class="string">&quot;blog-analytics@meta-domain.gserviceaccount.com&quot;</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦è®© API è®¿é—®åˆ° Google Analytics çš„æ•°æ®ï¼Œéœ€è¦æ‰“å¼€ Google Analytics åå°å°† client_email å®šä¹‰çš„é‚®ç®±ä½œä¸ºæ–°ç”¨æˆ·åŠ å…¥ï¼Œè¿™é‡Œæœ‰<a target="_blank" rel="noopener external nofollow noreferrer" href="https://support.google.com/analytics/answer/1009702">å®˜æ–¹æ•™ç¨‹</a></p><p>è®°ä½ï¼Œä¸€å®šè¦ä¿ç®¡å¥½å®ƒä»¬ï¼Œä¸ç„¶ä¸¢äº†è°éƒ½ä¸è®¤ä½  ğŸ¤ª</p><h1 id="éƒ¨ç½²åˆ°-Vercel">éƒ¨ç½²åˆ° Vercel</h1><p>è¿™é‡Œæ˜¯ç”¨ Vercel æ¥éƒ¨ç½² Serverless API é¡¹ç›®ï¼Œè´´ä¸ªå¤§ä½¬é¡¹ç›®çš„åŸåœ°å€ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/spencerwooo/ga-hit-count-serverless">spencerwooo/ga-hit-count-serverless</a>ï¼Œå¤§å®¶ Fork ä¸‹æ¥ä¿®æ”¹ä¸‹ <code>api/config.ts</code> é‡Œçš„é…ç½®å°±å¯ä»¥ç”¨äº†</p><h2 id="ä¿®æ”¹-config-ts-çš„é…ç½®">ä¿®æ”¹ config.ts çš„é…ç½®</h2><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Google Analytics query configurations</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ! If you are deploying this with your own account</span></span><br><span class="line"><span class="comment"> * ! , then you will need to change this config file.</span></span><br><span class="line"><span class="comment"> * ! Don&#x27;t put your privateKey inside this file directly!</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">viewId</span>: <span class="string">&quot;Google Analytics è§†å›¾ ID&quot;</span>,</span><br><span class="line">  <span class="attr">auth</span>: &#123;</span><br><span class="line">    <span class="attr">projectId</span>: <span class="string">&quot;Project ID&quot;</span>,</span><br><span class="line">    <span class="attr">privateKey</span>: process.env.PRIVATE_KEY,</span><br><span class="line">    <span class="attr">clientEmail</span>: <span class="string">&quot;blog-analytics@meta-domain.gserviceaccount.com&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">allFilter</span>: [<span class="string">&quot;/&quot;</span>],</span><br><span class="line">  <span class="attr">startDate</span>: <span class="string">&quot;2010-01-01&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯é…ç½®æ–‡ä»¶çš„æ ·å­</p><hr><p>è¿™é‡Œå°±ç›´æ¥å¼•ç”¨<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.spencerwoo.com/2020/06/serverless-ga-hit-count-api/">åŸæ–‡</a>ï½ï¼ˆè™½ç„¶æœ¬æ¥å°±æ˜¯ä¸åŸæ–‡å·®ä¸å¤šçš„è¯´</p><blockquote><p>å…¶ä¸­ï¼Œè¿™äº›å†…å®¹æˆ‘ä»¬éƒ½éœ€è¦ä¸€ä¸€è¿›è¡Œè®¾ç½®ï¼š</p><ul><li><code>viewId</code>ï¼šæ˜¯ä½ çš„ Google Analytics è§†å›¾ IDï¼Œå¯ä»¥åœ¨ Google Analytics åå°çš„ Admin Â» View Â» View Settings ä¸­æ‰¾åˆ°ï¼›<br><img src="https://i.loli.net/2020/06/25/VIWUvCqSyX23jed.png" class="lazy" data-srcset="https://i.loli.net/2020/06/25/VIWUvCqSyX23jed.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAABlBMVEXMzMyWlpYU2uzLAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAACklEQVQImWNgAAAAAgAB9HFkpgAAAABJRU5ErkJggg==" alt="Google Analytics è§†å›¾ ID çš„è®¾å®šä½ç½®"></li><li><code>projectId</code>ï¼šæ˜¯åˆšåˆšå‡­è¯ JSON æ–‡ä»¶ä¸­çš„ <code>project_id</code>ï¼Œç›´æ¥æŒ‰ç…§åˆšåˆšçš„å‡­è¯å¡«å†™å³å¯ï¼›</li><li><code>privateKey</code>ï¼šæ˜¯é€šè¿‡ Vercel ç¯å¢ƒå˜é‡è·å–åˆ°çš„ API å‡­è¯ç§é’¥ï¼Œ<strong>è¿™é‡Œä¸è¦æ›´æ”¹</strong>ï¼›</li><li><code>clientEmail</code>ï¼šæ˜¯åˆšåˆšå‡­è¯ JSON æ–‡ä»¶ä¸­çš„ <code>client_email</code>ï¼Œç›´æ¥æŒ‰ç…§åˆšåˆšçš„å‡­è¯å¡«å†™å³å¯ï¼›</li><li><code>allFilter</code>ï¼šæ˜¯é€šè¿‡ Google API æŸ¥è¯¢æ—¶çš„å‰ç¼€è¿‡æ»¤å™¨ï¼Œæ¯”å¦‚ä½ çš„ç½‘ç«™ä¸­æ–‡ç« è·¯å¾„ä»¥ <code>/post</code> å¼€å¤´ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®¾ç½®ä¸º <code>['/post']</code>ã€‚é»˜è®¤ä¸º <code>['/20']</code>ï¼ˆå› ä¸ºæˆ‘çš„æ–‡ç« è·¯å¾„æ˜¯ä»¥ <code>/2020</code> æˆ– <code>/2019</code> å¼€å¤´çš„ï¼‰ï¼›</li><li><code>startDate</code>ï¼šæ˜¯é€šè¿‡ Google API æŸ¥è¯¢æ—¶è®¾å®šæ—¶é—´æ®µçš„å¼€å§‹æ—¶é—´ï¼Œè®¾å®šä¸€ä¸ªæ¯”è¾ƒä¹…è¿œçš„æ—¶é—´å³å¯ï¼Œé»˜è®¤ä¸º <code>2010-01-01</code>ã€‚</li></ul></blockquote><div class="toast toast-warning">ğŸš¨ è¯·æ³¨æ„ï¼<br>è¿™é‡Œåƒä¸‡åƒä¸‡ä¸è¦ç›´æ¥å°†åˆšåˆšå‡­è¯ä¸­è·å–åˆ°çš„ç§é’¥ç›´æ¥ç²˜è´´è¿›å…¥ privateKey ä¸€é¡¹ä¹‹ä¸­ï¼Œå› ä¸ºè¿™æ ·å½“æˆ‘ä»¬å°† config.ts ç­¾å…¥ git ä¹‹åï¼ŒprivateKey å°†ä»¥æ˜æ–‡å½¢å¼ä¿å­˜ï¼Œéå¸¸å±é™©ã€‚</div><h2 id="å¯¼å…¥-Vercel">å¯¼å…¥ Vercel</h2><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://vercel.com/">Vercel</a>ï¼ˆè¿™å®¶ä¼™åˆåˆåˆæ¢åå­—äº†ï¼‰ï¼Œç”¨ GitHub æ³¨å†Œåï¼Œç›´æ¥å°†åˆšåˆš Fork å¹¶ä¿®æ”¹å¥½é…ç½®æ–‡ä»¶çš„é¡¹ç›®å¯¼å…¥å³å¯ï¼Œå•¥éƒ½ä¸ç”¨ç®¡å°±æ˜¯ <code>Continue</code></p><p>å¯¼å…¥å®Œæˆåè¿˜éœ€è¦è®¾ç½® <code>privateKey</code>ï¼Œåœ¨é¡¹ç›®çš„ <code>Project Settings</code> - <code>General</code> - <code>Environment Variables</code> - <code>Production</code> ä¸­æ·»åŠ ä¸€ä¸ª</p><ul><li><code>NAME</code> ä¸º <code>PRIVATE_KEY</code></li><li><code>VALUE</code> ä¸º <code>private_key</code><ul><li>è¿™ä¸ª <code>private_key</code> æ˜¯ä¸Šé¢çš„å“ªä¸ª json é‡Œçš„å¯¹åº”å€¼ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¦æŠŠ <code>\n</code> å…¨éƒ¨åˆ é™¤ï¼Œæ¢æˆæ¢è¡Œï¼ˆ<kbd>command</kbd> + <kbd>D</kbd> å¤§èƒœåˆ©ï¼ï¼‰</li></ul></li></ul><p>çš„å˜é‡</p><p>æœ€åéœ€è¦é‡æ–°è§¦å‘ä¸€æ¬¡éƒ¨ç½²ï¼Œéšä¾¿ commit ç‚¹ä¸œè¥¿æ›´æ–°ä¸€ä¸‹å°±è¡Œå•¦</p><h2 id="è°ƒç”¨-API">è°ƒç”¨ API</h2><p>Vercel åº”è¯¥ä¼šç»™ä½ åˆ†é…ä¸€ä¸ªç±»ä¼¼äº <code>https://xxxx.vercel.app</code> çš„åŸŸåï¼Œåœ¨æ ¹åŸŸååé¢æ·»åŠ  <code>/api/ga</code> è®¿é—®ï¼Œçœ‹çœ‹æ˜¯å¦ä¼šå°† Google Analytics é‡Œé¢å…¨éƒ¨è·¯å¾„ä¸è®¿é—®é‡æ‹‰å–å¹¶ä»¥ JSON response ç»™å‡º</p><p>è¿™ä¸ªè¯·æ±‚æ–¹æ³•æ˜¯åé¢å¸¦ä¸ª <code>?page=&#123;WEBSITE_PAGE_PATH&#125;</code>ï¼Œå…¶ä¸­ <code>&#123;WEBSITE_PAGE_PATH&#125;</code> æ˜¯ä½ åšæ–‡çš„ç›¸å¯¹è·¯å¾„ï¼Œè¿™æ ·å°±ä¼šè¿”å›ç»™å®šè·¯å¾„çš„æµè§ˆé‡å•¦ ğŸ˜†</p><p>ä¾‹å¦‚ç°åœ¨çš„è¿™ç¯‡åšæ–‡ï¼Œç›¸å¯¹è·¯å¾„æ˜¯ <code>/posts/google-analytics-hit-count/</code>ï¼Œé‚£ä¹ˆè¯·æ±‚çš„å°†æ˜¯</p><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//</span>xxxx.vercel.app<span class="regexp">/api/g</span>a?page=<span class="regexp">/posts/g</span>oogle-analytics-hit-count/</span><br></pre></td></tr></table></figure><p>âš ï¸ æ³¨æ„ï¼šæˆ‘è®¾ç½®äº†è‡ªå®šä¹‰åŸŸåï¼Œè®¿é—®çš„å°†æ˜¯<a target="_blank" rel="noopener external nofollow noreferrer" href="https://api.isteed.cc/api/ga?page=/posts/google-analytics-hit-count/">è¿™æ ·</a>çš„ï¼ˆä½ å¯ä»¥ç‚¹è¿›å»çœ‹çœ‹ï¼‰</p><p>å®ƒå°±ä¼šè¿”å›æ•°æ®ç»™ä½ ï¼Œç°åœ¨æˆ‘è¿™ç¯‡åšæ–‡çš„æµè§ˆé‡æ˜¯ <code>0</code>ï¼Œè¿”å›çš„æ•°æ®æ˜¯ä¸‹é¢è¿™æ ·çš„</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">[&#123;<span class="attr">&quot;page&quot;</span>:<span class="string">&quot;/posts/google-analytics-hit-count/&quot;</span>,<span class="attr">&quot;hit&quot;</span>:<span class="string">&quot;0&quot;</span>&#125;]</span><br></pre></td></tr></table></figure><hr><p>åŸæ–‡æœ‰çš„å°±åˆ°è¿™å„¿äº†ï¼Œæœ‰äº† API é‚£è¯¥æ€ä¹ˆç”¨å‘¢ï¼Ÿä¸‹é¢ä¾¿æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨æ–¹æ³•</p><h1 id="é›†æˆåˆ°-Hexo-ä¸»é¢˜">é›†æˆåˆ° Hexo ä¸»é¢˜</h1><p>è¿™ä¸‹ï¼ŒAPI æœ‰äº†ï¼Œè¯·æ±‚æ ¼å¼ä¹Ÿæœ‰äº†ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†å®ƒé›†æˆåœ¨è‡ªå·±çš„ä¸»é¢˜é‡Œå•¦ ğŸ˜†</p><p>ä¸‹é¢å°†ä»¥æˆ‘ç°åœ¨ä½¿ç”¨çš„ Hexo ä¸»é¢˜ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Lufsx/hexo-theme-suka">hexo-theme-suka</a> ä¸ºä¾‹</p><p>è¿™ä¸ªç®€å•çš„ js å°±å¼€æºåˆ° GitHub ä¸Šäº†ï¼Œè¿™é‡Œæ˜¯åœ°å€ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Lufsx/ga-hit-count">Lufsx/ga-hit-count</a>ï¼Œä¹‹åä¼šå†™ç‚¹ READMEï¼Œæœ€è¿‘åœ¨è€ƒè¯•ï¼Œæ²¡å•¥æ—¶é—´å‘¢ï¼ˆ<s>æ²¡å•¥æ—¶é—´æè¿™äº›ï¼Ÿ</s>ï¼‰</p><p>ç°åœ¨çš„è¿™ä¸ª js æœ‰ä¸€äº›é—®é¢˜ï¼Œä½†è¿˜ç”¨è¿˜æ˜¯èƒ½ç”¨å“’ ğŸ¤£ï¼ˆæœ‰æ—¶é—´å†å®Œå–„å‘¢</p><h2 id="åˆ›å»º-EJS">åˆ›å»º EJS</h2><p>é¦–å…ˆæ ¹æ®åŸä¸»é¢˜çš„è§„èŒƒï¼Œåœ¨ <code>/layout/_plugin/</code> æ–°å»ºäº†ä¸ªæ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾æ‰€éœ€è¦ç”¨åˆ°çš„ EJS æ–‡ä»¶</p><p>æ¥ä¸‹æ¥å°±æ˜¯æ–°å»ºæ–‡ä»¶å•¦ ğŸ¤ª</p><p>å…ˆç»™å®ƒæ–°å»ºä¸ª <code>import_js.ejs</code> ç”¨æ¥åœ¨å¤´éƒ¨å¼•å…¥ <code>js</code> æ–‡ä»¶ï¼Œä¼ é€’ä¸€ä¸ªå·²ç»æ­å»ºå¥½çš„ API åœ°å€çš„å‚æ•°</p><p>ä¸‹é¢æ˜¯ä»£ç å‘¢ï¼ˆèœé¸¡ä¸€ä¸ªï¼Œå¦‚æœæœ‰æ›´å¥½çš„å†™æ³•ï¼Œæ¬¢è¿æå‡ºå‘€ ğŸ¤£ï¼‰</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="built_in">window</span>.post_views_api = <span class="string">&quot;&lt;%= theme.ga_hit_count.post_views_api %&gt;&quot;</span>;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;% <span class="keyword">if</span> (theme.vendors.ga_hit_count) &#123; %&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&lt;%= theme.vendors.ga_hit_count %&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;% &#125; <span class="keyword">else</span> &#123; %&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/js/ga-views.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><p>å‰é¢å››è¡Œæ˜¯å®šä¹‰äº†ä¸€ä¸ªå˜é‡ <code>window.post_views_api</code>ï¼Œå€¼ä¸ºä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">ga_hit_count:</span></span><br><span class="line">  <span class="attr">post_views_api:</span> <span class="comment"># æ˜¯è¿™é‡Œçš„å€¼å‘€</span></span><br></pre></td></tr></table></figure><p>å®ƒä¼ é€’äº†ä½  API æ‰€åœ¨çš„åœ°å€</p><p>åé¢çš„äº”è¡Œåˆ™æ˜¯å¼•å…¥äº† js æ–‡ä»¶ï¼Œé¡ºä¾¿åˆ¤æ–­äº†ä¸‹æœ‰æ— è‡ªå®šä¹‰ js åœ°å€ï¼Œæ²¡æœ‰å°±è¿”å›å†…ç½®çš„ï¼Œè¿™ä¸ªè‡ªå®šä¹‰åœ°å€åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­é•¿è¿™æ ·</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">vendors:</span></span><br><span class="line">  <span class="attr">ga_hit_count:</span> <span class="comment"># è¿™é‡Œå°±æ˜¯è‡ªå®šä¹‰çš„åœ°å€å‘¢</span></span><br></pre></td></tr></table></figure><hr><p>æ¥ç€åœ¨åŒç›®å½•ä¸‹åˆ›å»ºä¸ª <code>post-counter.ejs</code></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!-- GA Hit Count Post Views --&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;post-meta-views&quot;</span> <span class="attr">hidden</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;suka-devide-dot&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>&lt;%- theme.ga_hit_count.before %&gt;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;pv-counter&quot;</span>&gt;</span>loading<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>&lt;%- theme.ga_hit_count.after %&gt;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯ç›´æ¥å¤åˆ¶ä¸»é¢˜å¸¦çš„å¦å¤–ä¸€ä¸ªæµè§ˆé‡ç»Ÿè®¡çš„ï¼ˆæ‡’</p><p>å®šä¹‰äº†ä¸€ä¸ª id ä¸º <code>post-meta-views</code> çš„ <code>&lt;span&gt;</code> åŒ…è£¹ç€ <code>pv-counter</code> çš„ <code>&lt;span&gt;</code></p><h2 id="å¼•å…¥-EJS">å¼•å…¥ EJS</h2><p>å…¨å±€å¼•å…¥çš„ EJS æ–‡ä»¶æ˜¯è¿™ä¸ª <code>/layout/_partial/source/footer.ejs</code></p><p>ç®€å•æ·»åŠ å‡ å¥ç›´æ¥å¸¦èµ°</p><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="addition">+    /* GA Hit Count */</span></span><br><span class="line"><span class="addition">+    if (theme.ga_hit_count.enable) html += partial(&#x27;_plugin/hit-count/import_js&#x27;);</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œåˆ¤æ–­ä¸»é¢˜æ–‡ä»¶ä¸­çš„ <code>enable</code> å€¼æ˜¯å¦ä¸º <code>true</code>ï¼Œæ˜¯åˆ™å¼•å…¥ <code>_plugin/hit-count/import_js</code></p><hr><p>æˆ‘ä¸»é¢˜åœ¨åšæ–‡é¡µé¢å¼•å…¥ç»Ÿè®¡æ‰€ç”¨çš„ EJS æ–‡ä»¶æ˜¯è¿™ä¸ª <code>/layout/_partial/post/header-info.ejs</code></p><p>ç®€å•æ·»åŠ å‡ å¥å†æ¬¡å¸¦èµ° ğŸ˜†</p><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="addition">+        &lt;% if ( (theme.ga_hit_count.enable) ) &#123; %&gt;</span></span><br><span class="line"><span class="addition">+            &lt;%- partial(&#x27;_plugin/hit-count/post-counter&#x27;, &#123;&#125;, &#123;cache: theme.fragment_cache&#125;) %&gt;</span></span><br><span class="line"><span class="addition">+        &lt;% &#125; %&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œåˆ¤æ–­ä¸»é¢˜æ–‡ä»¶ä¸­çš„ <code>enable</code> å€¼æ˜¯å¦ä¸º <code>true</code>ï¼Œæ˜¯åˆ™å¼•å…¥ <code>_plugin/hit-count/post-counter</code></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">ga_hit_count:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># æ˜¯çœ‹è¿™é‡Œæ˜¯ä¸æ˜¯ true å‘¢</span></span><br></pre></td></tr></table></figure><h2 id="æ ¸å¿ƒ-js">æ ¸å¿ƒ js</h2><p>å¼•å…¥éƒ½æå¥½å•¦ï¼Œé‚£ä¹ˆæœ€æ ¸å¿ƒçš„åœ°æ–¹å°±æ˜¯ç¼–å†™ js äº†ï¼ˆè™½ç„¶æ²¡å•¥æŠ€æœ¯å«é‡ï¼Œè¿˜å®ç°çš„ä¸å¤ªå®Œç¾ï¼‰</p><p>js æ–‡ä»¶å¼€æºåœ¨ GitHub ä¸Šï¼Œè¿™é‡Œæ˜¯åœ°å€ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Lufsx/ga-hit-count">Lufsx/ga-hit-count</a></p><p>ç›¸å…³ä½œç”¨ä¸è§£é‡Šç›´æ¥æ‰“æ³¨é‡Šä¸Šäº†ï¼ˆæ‡’ï½</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="comment">// æ‰¾åˆ° id ä¸º pv-counter çš„</span></span><br><span class="line">  <span class="keyword">var</span> obj = <span class="built_in">document</span>.getElementById(<span class="string">&quot;pv-counter&quot;</span>);</span><br><span class="line">  <span class="comment">// åŒä¸Š</span></span><br><span class="line">  <span class="keyword">var</span> show = <span class="built_in">document</span>.getElementById(<span class="string">&quot;post-meta-views&quot;</span>);</span><br><span class="line">  <span class="comment">// è·å– URL</span></span><br><span class="line">  <span class="keyword">var</span> url = <span class="built_in">document</span>.location.toString();</span><br><span class="line">  <span class="keyword">var</span> arrUrl = url.split(<span class="string">&quot;//&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> start = arrUrl[<span class="number">1</span>].indexOf(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">  <span class="comment">// æˆªå– URL ä¸­, ä»ç¬¬ä¸€ä¸ª / å¼€å§‹çš„åœ°å€</span></span><br><span class="line">  <span class="keyword">var</span> relUrl = arrUrl[<span class="number">1</span>].substring(start);</span><br><span class="line">  <span class="comment">// å¦‚æœç›¸å¯¹åœ°å€ä¸­å¸¦æœ‰å‚æ•°, é‚£ä¹ˆæˆªæ‰</span></span><br><span class="line">  <span class="comment">//ä¾‹å¦‚å¾®ä¿¡æ‰“å¼€çš„ä¸œè¥¿åé¢éƒ½ä¼šå¸¦ä¸€ä¸²ç‚’é¸¡é•¿çš„å‚æ•°</span></span><br><span class="line">  <span class="keyword">if</span> (relUrl.indexOf(<span class="string">&quot;?&quot;</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">    relUrl = relUrl.split(<span class="string">&quot;?&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ä» API è·å–æ•°æ®</span></span><br><span class="line">  <span class="keyword">const</span> json = <span class="keyword">await</span> fetch(</span><br><span class="line">    <span class="string">`<span class="subst">$&#123;<span class="built_in">window</span>.post_views_api&#125;</span>?page=<span class="subst">$&#123;relUrl&#125;</span>`</span></span><br><span class="line">  ).then(<span class="function">(<span class="params">res</span>) =&gt;</span> res.json());</span><br><span class="line">  <span class="comment">// èµ‹å€¼ hit ä¸ºæµè§ˆé‡</span></span><br><span class="line">  <span class="keyword">const</span> hit = json[<span class="number">0</span>].hit;</span><br><span class="line">  <span class="comment">// å¦‚æœ hit ä¸æ˜¯æœªå®šä¹‰, å­˜åœ¨ id ä¸º post-meta-views</span></span><br><span class="line">  <span class="keyword">if</span> (hit !== <span class="literal">undefined</span> &amp;&amp; show !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// é‚£ä¹ˆå°† id ä¸º pv-counter çš„å†…å®¹æ›¿æ¢ä¸ºæµè§ˆé‡</span></span><br><span class="line">    obj.innerHTML = <span class="string">`<span class="subst">$&#123;hit&#125;</span>`</span>;</span><br><span class="line">    <span class="comment">// å¹¶å°†å®ƒå¯è§</span></span><br><span class="line">    show.hidden = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>js çš„æ•ˆæœå¤§æ¦‚å°±æ˜¯è·å–æµè§ˆé‡ï¼Œè·å–å®Œæˆåå†™å…¥ï¼Œå†å°†å…ƒç´ è®¾ç½®ä¸ºå¯è§</p><h2 id="æˆæœ">æˆæœ</h2><p>æœ€åï¼Œä¸»é¢˜é…ç½®æ–‡ä»¶æ˜¯è¿™æ ·å­çš„</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">ga_hit_count:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">post_views_api:</span> <span class="string">https://api.isteed.cc/api/ga</span> <span class="comment"># Example: https://domain.com/api/ga</span></span><br><span class="line">  <span class="attr">before:</span> <span class="comment"># html tag support</span></span><br><span class="line">  <span class="attr">after:</span> <span class="string">Views</span> <span class="comment"># html tag support</span></span><br><span class="line"><span class="attr">vendors:</span></span><br><span class="line">  <span class="attr">ga_hit_count:</span> <span class="comment"># è¿™é‡Œå°±æ˜¯è‡ªå®šä¹‰çš„åœ°å€å‘¢</span></span><br></pre></td></tr></table></figure><hr><p>æœ€ç»ˆæ•ˆæœå°±å¦‚ä½ ç°åœ¨æµè§ˆçš„è¿™ä¸€ç¯‡åšæ–‡ä¸€æ ·å‘¢</p><h1 id="ç¢ç¢å¿µ">ç¢ç¢å¿µ</h1><p>ç»ˆäºåˆé‡ä¸Šäº†æµè§ˆé‡ç»Ÿè®¡å•¦</p><p>è¿™ä¸ªä¸œè¥¿çš„å¥½å¤„å°±æ˜¯ç›´æ¥ä½¿ç”¨ Google Analytics æ•°æ®ï¼Œä¸€ä¸ª Google Analytics ç»Ÿè®¡ä»£ç é€šåƒ</p><p>ä½†æ•°æ®æ›´æ–°ä¸å¤ªåŠæ—¶å‘¢ï¼Œè€Œä¸”åŸ Google Analytics åˆç‰¹åˆ«é˜»ç¢é¡µé¢çš„åŠ è½½ï¼Œä¸è¿‡è¿˜å¥½ï¼Œå¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/SukkaW/cloudflare-workers-async-google-analytics">SukkaW/cloudflare-workers-async-google-analytics</a>ã€<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/giuem/ga-proxy">giuem/ga-proxy</a> ç­‰è§£å†³æ–¹æ¡ˆ</p><hr><p>ä»€ä¹ˆï¼Ÿä½ é—®æˆ‘ macOS åº”ç”¨æ¨èç¬¬äºŒæœŸå»å“ªå„¿äº†ï¼Ÿå½“ç„¶æ˜¯å’•äº† ğŸ¤ª</p><p>ä¸è¿‡å·²ç»åœ¨å†™äº†ï¼ˆæŒ‡æ–°å»ºæ–‡ä»¶</p><h1 id="å‚è€ƒé“¾æ¥-å…³è”é˜…è¯»">å‚è€ƒé“¾æ¥/å…³è”é˜…è¯»</h1><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://printempw.github.io/google-analytics-api-page-views-counter/">PRIN BLOG</a><br><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.spencerwoo.com/2020/06/serverless-ga-hit-count-api/">Spencerâ€™s Blog</a></p></article><blockquote class="post-license"><p><strong>æœ¬æ–‡ä½œè€…&nbsp;:&nbsp;Lufs</strong><br><strong>æœ¬æ–‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½å’Œå¼•ç”¨æ—¶è¯·æ³¨æ„éµå®ˆåè®®ï¼</strong><br><strong>æœ¬æ–‡é“¾æ¥&nbsp;:&nbsp;</strong><a href="https://blog.isteed.cc/post/google-analytics-hit-count/">https://blog.isteed.cc/post/google-analytics-hit-count/</a></p></blockquote><blockquote id="date-expire-notification" class="post-expired-notify">æœ¬æ–‡æœ€åæ›´æ–°äº <span id="date-expire-num"></span> å¤©å‰ï¼Œæ–‡ä¸­æ‰€æè¿°çš„ä¿¡æ¯å¯èƒ½å·²å‘ç”Ÿæ”¹å˜</blockquote><script>!function(){var e=Date.parse("2020-07-16"),t=(new Date).getTime(),e=Math.floor((t-e)/864e5);120<=e?document.getElementById("date-expire-num").innerHTML=e:document.getElementById("date-expire-notification").style.display="none"}()</script><p class="post-footer-info mb-0 pt-0">æœ¬æ–‡å‘è¡¨äº&nbsp;<time datetime="2020-06-26T17:06:57.000Z" itemprop="datePublished">2020-06-27</time> , æœ€åä¿®æ”¹äº&nbsp;<time datetime="2020-07-16T08:53:57.000Z" itemprop="dateModified">2020-07-16</time></p><p class="post-footer-info mb-0 pt-2"><span class="post-categories-list mt-2"><a class="post-categories-list-item" href="/categories/%E5%88%86%E4%BA%AB/">åˆ†äº«</a> </span><span class="post-tags-list mt-2"><a class="post-tags-list-item" href="/tags/Google-Analytics/" rel="tag">#&nbsp;Google Analytics</a> <a class="post-tags-list-item" href="/tags/Blog/" rel="tag">#&nbsp;Blog</a> <a class="post-tags-list-item" href="/tags/Page-View/" rel="tag">#&nbsp;Page View</a> <a class="post-tags-list-item" href="/tags/Vercel/" rel="tag">#&nbsp;Vercel</a></span></p></div><div class="post-nav px-2 bg-gray"><ul class="pagination"><li class="page-item page-prev"><a href="/post/macos-software/" rel="prev"><div class="page-item-title"><i class="icon icon-back" aria-hidden="true"></i></div><div class="page-item-subtitle">ã€ŒMac çš„æœ¬é¢†ï¼Œçªé£çŒ›è¿›ã€‚ã€ â€”â€” macOS åº”ç”¨æ¨èç¬¬äºŒæœŸ</div></a></li><li class="page-item page-next"><a href="/post/how-to-go-tg/" rel="next"><div class="page-item-title"><i class="icon icon-forward" aria-hidden="true"></i></div><div class="page-item-subtitle">ä¼˜ç§€ã€è½»å¿«ã€å®‰å…¨çš„å³æ—¶é€šè®¯ â€”â€” Telegram å…¥å‘æŒ‡å—</div></a></li></ul></div><div class="card-footer post-comment"><div id="disqus_thread"></div><script id="js-disqusjs" src="https://cdn.jsdelivr.net/npm/disqusjs@1.3.0/dist/disqus.js" async></script><script>document.getElementById("js-disqusjs").addEventListener("load",function(){function t(){new DisqusJS({shortname:"lufss-blog",siteName:"Lufs&#39;s Blog",identifier:"https://blog.isteed.cc/post/google-analytics-hit-count/",url:"https://blog.isteed.cc/post/google-analytics-hit-count/",api:"https://disqus.isteed.cc/",apikey:"f8sCuFyS82pto94gZ0V4xtPbYZlLej6xVCTPNyZ0CXlfZz25L8lqsnsxYVCPDhzc",admin:"Lufs_x"})}"complete"===document.readyState?t():window.addEventListener("load",t)})</script></div></div></div></div></div><footer class="text-center"><p class="footer-copyright mb-0">Copyright&nbsp;Â©&nbsp;<span id="copyright-year"></span> <a class="footer-copyright-a" href="https://blog.isteed.cc">Lufs's Blog</a></p><p class="footer-text mb-0"><a href="/atom.xml"><img src="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/svg/subscribe-via-rss.svg"></a></p><p class="footer-develop mb-0">Powered by&nbsp;<a href="https://hexo.io" target="_blank" class="footer-develop-a" rel="external nofollow noopener noreferrer">Hexo</a><span class="footer-develop-divider"></span>Theme&nbsp;-&nbsp;<a href="https://github.com/SukkaW/hexo-theme-suka" target="_blank" class="footer-develop-a" rel="external noopener">Suka</a></p></footer><script>window.lazyLoadOptions={elements_selector:".lazy",threshold:50},function(){var e=(new Date).getFullYear(),o=document.getElementById("copyright-year");o.textContent=2018===e?e:"2018 - "+e}(),console.log("\n %c Suka Theme (hexo-theme-suka) | Â© SukkaW | Verision 1.3.3 %c https://github.com/SukkaW/hexo-theme-suka \n","color: #fff; background: #444; padding:5px 0;","background: #bbb; padding:5px 0;")</script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@16.1.0/dist/lazyload.iife.min.js" async></script><script>window.post_views_api="https://api.isteed.cc/api/ga"</script><script src="https://cdn.jsdelivr.net/gh/lufsx/res@0.2.2/file/ga-views.js"></script></body></html>