<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="x-dns-prefetch-control" content="on"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,maximum-scale=5,viewport-fit=cover"><meta name="renderer" content="webkit"><title>ä½¿ç”¨ Cloudflare å¯¹ GitHub æ–‡ä»¶åŠ é€Ÿ | Lufs&#39;s Blog</title><link rel="icon" type="image&#x2F;ico" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.1/favicon/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.1/favicon/apple-touch-icon.png"><link rel="icon" typt="image&#x2F;png" sizes="192x192" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.1/favicon/android-chrome-192x192.png"><link rel="icon" typt="image&#x2F;png" sizes="32x32" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.1/favicon/favicon-32x32.png"><link rel="icon" typt="image&#x2F;png" sizes="16x16" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.1/favicon/favicon-16x16.png"><link rel="mask-icon" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.1/favicon/safari-pinned-tab.svg" color="rgba(241,249,250,1)"><meta name="theme-color" content="rgba(241,249,250,1)"><link rel="stylesheet" href="/lib/spectre/spectre.min.css"><style>body{background-color:#f1f9fa}a,a:visited{color:#8f82bc}a:active,a:focus,a:hover{color:#8f82bc;opacity:.75}#post-content a,#post-content a:focus,#post-content a:hover,#post-content a:visited{color:#8f82bc;opacity:1}#post-content img.lazy{transition:filter .35s ease 0s}#post-content img.lazy:not(.loaded){visibility:hidden;-webkit-filter:blur(5px);filter:blur(5px)}#post-content img.lazy:not(.loaded):not(.loading){padding-bottom:68%}#post-content img.lazy.error{display:none}.post-entry .card-body a{color:#7065a3}.avatar{background:#7065a3}.navbar-link,.navbar-link:visited,.timeline .timeline-item .timeline-icon.icon-lg{color:#7065a3}.navbar-link:hover{color:#7065a3;opacity:.8}#disqus-loadmore-button,#disqus-switch-to-direct,#disqus_click_btn,#search-input .btn{background:#7065a3;border-color:#7065a3;color:#fff}#post-toc a.post-toc-link,#post-toc a.post-toc-link:visited,.share-menu.menu .menu-item>a{color:#7065a3}.share-menu.menu .menu-item>a:focus,.share-menu.menu .menu-item>a:hover,.share-menu.menu .menu-item>a:visited{color:#50596c;background:#f1f9fa;opacity:.85}</style><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.4/file/disqusjs.min.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.4/file/disqusjs.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.8/file/atom-one.min.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.8/file/atom-one.min.css"></noscript><script>!function(n){"use strict";n.loadCSS||(n.loadCSS=function(){});var t,o=loadCSS.relpreload={};o.support=function(){var e;try{e=n.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),o.bindMediaToggle=function(t){var e=t.media||"all";function a(){t.addEventListener?t.removeEventListener("load",a):t.attachEvent&&t.detachEvent("onload",a),t.setAttribute("onload",null),t.media=e}t.addEventListener?t.addEventListener("load",a):t.attachEvent&&t.attachEvent("onload",a),setTimeout(function(){t.rel="stylesheet",t.media="only x"}),setTimeout(a,3e3)},o.poly=function(){if(!o.support())for(var t=n.document.getElementsByTagName("link"),e=0;e<t.length;e++){var a=t[e];"preload"!==a.rel||"style"!==a.getAttribute("as")||a.getAttribute("data-loadcss")||(a.setAttribute("data-loadcss",!0),o.bindMediaToggle(a))}},o.support()||(o.poly(),t=n.setInterval(o.poly,500),n.addEventListener?n.addEventListener("load",function(){o.poly(),n.clearInterval(t)}):n.attachEvent&&n.attachEvent("onload",function(){o.poly(),n.clearInterval(t)})),"undefined"!=typeof exports?exports.loadCSS=loadCSS:n.loadCSS=loadCSS}("undefined"!=typeof global?global:this)</script><meta name="google-site-verification" content="wk686q2aTrts7GR0yVJ7UrALaAodD62StMuSuH7dMOU"><meta name="mobile-web-app-capable" content="yes"><meta name="application-name" content="Lufs's Blog"><meta name="msapplication-starturl" content="https://blog.isteed.cc"><meta name="msapplication-navbutton-color" content="rgba(241,249,250,1)"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Lufs's Blog"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="search" type="application/opensearchdescription+xml" href="/source/opensearch.xml" title="Lufs's Blog"><meta property="og:title" content="ä½¿ç”¨ Cloudflare å¯¹ GitHub æ–‡ä»¶åŠ é€Ÿ | Lufs&#39;s Blog"><meta property="og:site_name" content="Lufs&#39;s Blog"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.isteed.cc/post/cloudflare-gh-proxy/"><meta property="og:locale" content="zh-CN"><meta name="description" content="ä»Šå¹´å››æœˆåˆï¼Œåœ¨é¢‘é“çœ‹è§ä¸€ä¸ªå¯ä»¥åˆ©ç”¨ Cloudflare åŠ é€Ÿ GitHub æ–‡ä»¶çš„é¡¹ç›®ã€‚ - Lufs - Lufs&#39;s Blog"><meta name="keywords" content="æ°´, Cloudflare, GitHub, Proxy, Lufs, Lufs Blog, Hexo, hexo, Android, blog, æ°´æ€ª"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/cloudflare-gh-proxy/thumbnail.jpg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/cloudflare-gh-proxy/white.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/cloudflare-gh-proxy/dark.png"><meta property="article:published_time" content="2020-05-09T09:03:04.000Z"><meta property="article:modified_time" content="2020-05-09T15:34:27.000Z"><meta property="og:updated_time" content="2020-05-09T15:34:27.000Z"><meta property="article:author" content="Lufs"><meta property="article:tag" content="æ°´, Cloudflare, GitHub, Proxy, Lufs, Lufs Blog, Hexo, hexo, Android, blog, æ°´æ€ª"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/cloudflare-gh-proxy/thumbnail.jpg"><link rel="canonical" href="https://blog.isteed.cc/post/cloudflare-gh-proxy/"><meta name="generator" content="Hexo 5.4.0"><script>window.ga_tid="UA-139861604-1",window.ga_api="https://cfga.lufs.workers.dev"</script><script async>!function(e,n,a){function r(t){return isNaN(t)||t==1/0||t<0?void 0:t}function o(t){return Math.random().toString(36).slice(-t)}function i(t){return Math.ceil(Math.random()*(t-1))+1}var d=e.screen,c=encodeURIComponent,g=Math.max,t=e.performance,m=t&&t.timing;function s(){var t=[o(i(4))+"="+o(i(6)),"ga="+e.ga_tid,"dt="+c(n.title),"de="+c(n.characterSet||n.charset),"dr="+c(n.referrer),"ul="+(a.language||a.browserLanguage||a.userLanguage),"sd="+d.colorDepth+"-bit","sr="+d.width+"x"+d.height,"vp="+g(n.documentElement.clientWidth,e.innerWidth||0)+"x"+g(n.documentElement.clientHeight,e.innerHeight||0),"plt="+r(m.loadEventStart-m.navigationStart||0),"dns="+r(m.domainLookupEnd-m.domainLookupStart||0),"pdt="+r(m.responseEnd-m.responseStart||0),"rrt="+r(m.redirectEnd-m.redirectStart||0),"tcp="+r(m.connectEnd-m.connectStart||0),"srt="+r(m.responseStart-m.requestStart||0),"dit="+r(m.domInteractive-m.domLoading||0),"clt="+r(m.domContentLoadedEventStart-m.navigationStart||0),"z="+Date.now()];e.__ga_img=new Image,e.__ga_img.src=e.ga_api+"?"+t.join("&")}e.cfga=s,"complete"===n.readyState?s():e.addEventListener("load",s)}(window,document,navigator)</script><script type="application/ld+json">{
    "@context": "http://schema.org",
    "url": "https://blog.isteed.cc/post/cloudflare-gh-proxy/",
    "@type": "BlogPosting",
    "logo": "https://cdn.jsdelivr.net/gh/lufsx/res@0.1.1/favicon/android-chrome-192x192.png",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://blog.isteed.cc/post/cloudflare-gh-proxy/"
    },
    "headline": "ä½¿ç”¨ Cloudflare å¯¹ GitHub æ–‡ä»¶åŠ é€Ÿ | Lufs&#39;s Blog",
    
    "image": {
        "@type": "ImageObject",
        "url": "https://cdn.jsdelivr.net/gh/lufsx/res@master/img/cloudflare-gh-proxy/thumbnail.jpg"
    },
    
    "datePublished": "2020-05-09T09:03:04.000Z",
    "dateModified": "2020-05-09T15:34:27.000Z",
    "author": {
        "@type": "Person",
        "name": "Lufs",
        "image": {
            "@type": "ImageObject",
            "url": "https://cdn.jsdelivr.net/gh/lufsx/res@0.1.1/avatar/avatar-36x36.png"
        },
        "description": "Life feeds on negative entropy."
    },
    "publisher": {
        "@type": "Organization",
        "name": "Lufs&#39;s Blog",
        "logo": {
            "@type": "ImageObject",
            "url": "https://cdn.jsdelivr.net/gh/lufsx/res@0.1.1/favicon/android-chrome-192x192.png"
        }
    },
    
    "potentialAction": {
        "@type": "SearchAction",
        "target": "https://blog.isteed.cc/search?s={search_term_string}",
        "query-input": "required name=search_term_string"
    },
    
    "keywords": "æ°´, Cloudflare, GitHub, Proxy, Lufs, Lufs Blog, Hexo, hexo, Android, blog, æ°´æ€ª",
    "description": "ä»Šå¹´å››æœˆåˆï¼Œåœ¨é¢‘é“çœ‹è§ä¸€ä¸ªå¯ä»¥åˆ©ç”¨ Cloudflare åŠ é€Ÿ GitHub æ–‡ä»¶çš„é¡¹ç›®ã€‚ - Lufs - Lufs&#39;s Blog"
}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.9/file/dark.min.css" media="(prefers-color-scheme:dark)" crossorigin><script>"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js").then(function(e){console.log("Yay! ServiceWorker is loaded ğŸ‰")},function(e){console.log("Oh! ServiceWorker registration failed ğŸ˜¥")})})</script><script>console.log("\n %c Lufs's Blog %c https://blog.isteed.cc/ \n","color: #fff; background: #7065a3; padding:5px 0;","background: #f0fafb; padding:5px 0;"),console.log("%c ","background:url(https://cdn.jsdelivr.net/gh/lufsx/res@0.2.5/file/background.png) no-repeat center;background-size:200px;padding-left:200px;padding-bottom:162px;overflow:hidden;border-radius:10px;margin:5px 0")</script><script async src="https://cdn.splitbee.io/sb.js"></script><script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{token:" e4aef4b9b850426b92d9dad86089c719}></script><link rel="alternate" href="/atom.xml" title="Lufs's Blog" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="Lufs's Blog" type="application/rss+xml"></head><body><header><h1 class="header-title text-center"><a href="/">Lufs&#39;s Blog</a></h1><p class="text-center header-slogan">Life feeds on negative entropy.</p><nav class="navbar-section text-center"><a href="/" class="navbar-link">é¦–é¡µ</a> <a href="/archives/" class="navbar-link">å½’æ¡£</a> <a href="/search" class="navbar-link">æœç´¢</a> <a href="/welfare/" class="navbar-link">ç¦åˆ©</a> <a href="/post/about/" class="navbar-link">å…³äº</a> <a href="/links/" class="navbar-link">å‹é“¾</a></nav></header><div class="post-container"><div id="post-card" class="card"><div class="card-image lazy" crossorigin data-bg="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/cloudflare-gh-proxy/thumbnail.jpg"></div><div class="card-item-container"><div class="card-inner-cell"><div class="card-header"><h1 class="card-title h3 mb-2">ä½¿ç”¨ Cloudflare å¯¹ GitHub æ–‡ä»¶åŠ é€Ÿ</h1><div class="post-header-info"><p class="post-header-info-left text-gray"><img class="author-thumb lazy" data-src="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.1/avatar/avatar-36x36.png" src="/img/suka-lazyload.gif" alt="Lufs's Avatar"> <span>2020-05-09</span> <span class="suka-devide-dot"></span> <a class="category-link" href="/categories/%E6%97%A5%E5%B8%B8/">æ—¥å¸¸</a><span class="suka-devide-dot"></span><a class="category-link" href="/categories/%E6%97%A5%E5%B8%B8/%E5%88%86%E4%BA%AB/">åˆ†äº«</a><span id="post-meta-views" hidden><span class="suka-devide-dot"></span> <span></span> <span id="pv-counter">loading</span> <span>Views</span></span></p><div class="post-header-info-right"><div class="dropdown dropdown-right"><a class="dropdown-toggle" tabindex="0">åˆ†äº«æœ¬æ–‡</a><ul class="menu share-menu"><li class="menu-item"><a href="http://service.weibo.com/share/share.php?appkey=&title=ä½¿ç”¨ Cloudflare å¯¹ GitHub æ–‡ä»¶åŠ é€Ÿ&url=https://blog.isteed.cc/post/cloudflare-gh-proxy/&pic=https://cdn.jsdelivr.net/gh/lufsx/res@master/img/cloudflare-gh-proxy/thumbnail.jpg&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">åˆ†äº«åˆ°å¾®åš</a></li><li class="menu-item"><a href="http://connect.qq.com/widget/shareqq/index.html?site=Lufs's Blog&title=Lufs's Blog&summary=Life feeds on negative entropy.&pics=https://cdn.jsdelivr.net/gh/lufsx/res@master/img/cloudflare-gh-proxy/thumbnail.jpg&url=https://blog.isteed.cc/post/cloudflare-gh-proxy/" target="_blank" rel="external noopener noreferrer nofollow">åˆ†äº«åˆ° QQ</a></li><li class="menu-item"><a href="https://t.me/share/url?url=https://blog.isteed.cc/post/cloudflare-gh-proxy/&text=Lufs's Blog" target="_blank" rel="external noopener noreferrer nofollow">åˆ†äº«åˆ° Telegram</a></li><li class="menu-item"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJQAAACUCAAAAABQV18IAAAB1ElEQVR42u3awa7DIAxE0fz/T7fbLszMdZRK4Ew2T69p4FQiNhiuz4bXFVRQQQVVoC5xqfvq+d97tJ+gZqHKQbdAVZ0pAO0nqHko1fGq4arz6j7tJ6h3oKoBrECkvaDejVID3CXe6scF9R6UC5RVw+rz1QvwyCwhqO1RbuHw1N9HVzNBbYuyRQeRcN1k7m9Vl6C2Rq0Cn5qgkc9kkFwF4aBGoNRgdRM6N3mr/pd9BTUKpQY7WXTSRcQKF9QcFC1Y0EK+as8F2aDmoNyEvlt0dQk4qPkoEkA7Cwm6gAhqJookSpq0V4Meb0gFNQrlGqOb3G5ip350UHNQKok6oEvsdPMyqDkoerjGbVK751yhI6g5KBU0adImzzpQUPNQZBFBg2y3qBbUPNSdoqx6EdT32pO8oI5DdQ7A00lh5+XAJziCOgbVGeidYgjdHA9qJookT3dAorPosMX9oI5GkSIFPSBxN0EHNQtFgijdvFaB0i1GgpqDogeaXWc0UOK3L6ijUaRAQYIf+T4+uR/U8SiyuegmfzTB20JsUKNR5GCNC7puYzOo96Io1B2QQIXYoI5HuUHpDteoIi7d7AxqDookzs6i0yXsWxtGQR2D2ukKKqiggvq5vgO2UG+edOocAAAAAElFTkSuQmCC" alt="QRCode"></li></ul></div></div></div></div><div class="card-body"><div id="post-toc"><ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E9%83%A8%E7%BD%B2"><span class="post-toc-number">1.</span> <span class="post-toc-text">éƒ¨ç½²</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E3%80%8C%E7%BE%8E%E5%8C%96%E3%80%8D"><span class="post-toc-number">2.</span> <span class="post-toc-text">ã€Œç¾åŒ–ã€</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%BA%94%E7%94%A8"><span class="post-toc-number">3.</span> <span class="post-toc-text">åº”ç”¨</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E7%A2%8E%E7%A2%8E%E5%BF%B5"><span class="post-toc-number">4.</span> <span class="post-toc-text">ç¢ç¢å¿µ</span></a></li></ol></div><article id="post-content"><p>ä»Šå¹´å››æœˆåˆï¼Œåœ¨é¢‘é“çœ‹è§ä¸€ä¸ªå¯ä»¥åˆ©ç”¨ Cloudflare åŠ é€Ÿ GitHub æ–‡ä»¶çš„é¡¹ç›®ã€‚</p><span id="more"></span><p>æˆ‘çœ‹è§åï¼Œä¾¿æŒ‰èµ·äº† <kbd>command</kbd> + <kbd>C</kbd>ï¼Œ<kbd>command</kbd> + <kbd>V</kbd></p><p>å¤åˆ¶ç²˜è´´ä¿å­˜è§£æï¼Œè®¾ç½® worker è§„åˆ™ï¼Œä¸€é¡¿æ“ä½œ</p><p>å•ªï¼ŒGitHub åŠ é€Ÿå°±æ˜¯æˆ‘æ»´å•¦</p><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/hunshcn/gh-proxy">GitHub å¼€æºé¡¹ç›®</a><br>æˆ‘ã€Œç¾åŒ–ã€è¿‡çš„<a target="_blank" rel="noopener external nofollow noreferrer" href="https://gh.isteed.cc/">ç«™ç‚¹</a></p><h1 id="éƒ¨ç½²">éƒ¨ç½²</h1><p>è¦è‡ªå·±éƒ¨ç½²å¾ˆç®€å•ï¼ŒæŠŠå…¨éƒ¨çš„ ä»£ç  ç²˜è´´åˆ° Cloudflare å°±è¡Œäº†</p><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/hunshcn/gh-proxy">é¡¹ç›®</a>æœ‰ä¸­æ–‡æ–‡æ¡£ï¼ŒCloudflare ç°åœ¨ä¹Ÿæœ‰ä¸­æ–‡ï¼Œè‡ªå·±å°±å¯ä»¥è½»æ¾éƒ¨ç½²ï¼ˆ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * static files (404.html, sw.js, conf.js)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> ASSET_URL = <span class="string">&quot;https://hunshcn.github.io/gh-proxy&quot;</span>;</span><br><span class="line"><span class="comment">// å‰ç¼€ï¼Œå¦‚æœè‡ªå®šä¹‰è·¯ç”±ä¸ºexample.com/gh/*ï¼Œå°†PREFIXæ”¹ä¸º &#x27;/gh/&#x27;ï¼Œæ³¨æ„ï¼Œå°‘ä¸€ä¸ªæ éƒ½ä¼šé”™ï¼</span></span><br><span class="line"><span class="keyword">const</span> PREFIX = <span class="string">&quot;/&quot;</span>;</span><br><span class="line"><span class="comment">// gitä½¿ç”¨cnpmjsé•œåƒã€åˆ†æ”¯æ–‡ä»¶ä½¿ç”¨jsDelivré•œåƒçš„å¼€å…³ï¼Œ0ä¸ºå…³é—­ï¼Œé»˜è®¤å¼€å¯</span></span><br><span class="line"><span class="keyword">const</span> Config = &#123;</span><br><span class="line">  <span class="attr">jsdelivr</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">cnpmjs</span>: <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** <span class="doctag">@type <span class="type">&#123;RequestInit&#125;</span> </span>*/</span></span><br><span class="line"><span class="keyword">const</span> PREFLIGHT_INIT = &#123;</span><br><span class="line">  <span class="attr">status</span>: <span class="number">204</span>,</span><br><span class="line">  <span class="attr">headers</span>: <span class="keyword">new</span> Headers(&#123;</span><br><span class="line">    <span class="string">&quot;access-control-allow-origin&quot;</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">    <span class="string">&quot;access-control-allow-methods&quot;</span>:</span><br><span class="line">      <span class="string">&quot;GET,POST,PUT,PATCH,TRACE,DELETE,HEAD,OPTIONS&quot;</span>,</span><br><span class="line">    <span class="string">&quot;access-control-max-age&quot;</span>: <span class="string">&quot;1728000&quot;</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;any&#125;</span> <span class="variable">body</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;number&#125;</span> <span class="variable">status</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&lt;string, string&gt;&#125;</span> <span class="variable">headers</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeRes</span>(<span class="params">body, status = <span class="number">200</span>, headers = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">  headers[<span class="string">&quot;access-control-allow-origin&quot;</span>] = <span class="string">&quot;*&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Response(body, &#123; status, headers &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">urlStr</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">newUrl</span>(<span class="params">urlStr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> URL(urlStr);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">addEventListener(<span class="string">&quot;fetch&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> ret = fetchHandler(e).catch(<span class="function">(<span class="params">err</span>) =&gt;</span></span><br><span class="line">    makeRes(<span class="string">&quot;cfworker error:\n&quot;</span> + err.stack, <span class="number">502</span>)</span><br><span class="line">  );</span><br><span class="line">  e.respondWith(ret);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;FetchEvent&#125;</span> <span class="variable">e</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchHandler</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> req = e.request;</span><br><span class="line">  <span class="keyword">const</span> urlStr = req.url;</span><br><span class="line">  <span class="keyword">const</span> urlObj = <span class="keyword">new</span> URL(urlStr);</span><br><span class="line">  <span class="keyword">let</span> path = urlObj.searchParams.get(<span class="string">&quot;q&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (path) &#123;</span><br><span class="line">    <span class="keyword">return</span> Response.redirect(<span class="string">&quot;https://&quot;</span> + urlObj.host + PREFIX + path, <span class="number">301</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// cfworker ä¼šæŠŠè·¯å¾„ä¸­çš„ `//` åˆå¹¶æˆ `/`</span></span><br><span class="line">  path = urlObj.href</span><br><span class="line">    .substr(urlObj.origin.length + PREFIX.length)</span><br><span class="line">    .replace(<span class="regexp">/^https?:\/+/</span>, <span class="string">&quot;https://&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> exp1 = <span class="regexp">/^(?:https?:\/\/)?github\.com\/.+?\/.+?\/(?:releases|archive)\/.*$/i</span>;</span><br><span class="line">  <span class="keyword">const</span> exp2 = <span class="regexp">/^(?:https?:\/\/)?github\.com\/.+?\/.+?\/(?:blob)\/.*$/i</span>;</span><br><span class="line">  <span class="keyword">const</span> exp3 = <span class="regexp">/^(?:https?:\/\/)?github\.com\/.+?\/.+?\/(?:info|git-upload-pack).*$/i</span>;</span><br><span class="line">  <span class="keyword">const</span> exp4 = <span class="regexp">/^(?:https?:\/\/)?raw\.githubusercontent\.com\/.+?\/.+?\/.+?\/.+$/i</span>;</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    path.search(exp1) === <span class="number">0</span> ||</span><br><span class="line">    (!Config.jsdelivr &amp;&amp; path.search(exp2) === <span class="number">0</span>) ||</span><br><span class="line">    (!Config.cnpmjs &amp;&amp; (path.search(exp3) === <span class="number">0</span> || path.search(exp4)))</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> httpHandler(req, path);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (path.search(exp2) === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> newUrl = path</span><br><span class="line">      .replace(<span class="string">&quot;/blob/&quot;</span>, <span class="string">&quot;@&quot;</span>)</span><br><span class="line">      .replace(<span class="regexp">/^(?:https?:\/\/)?github\.com/</span>, <span class="string">&quot;https://cdn.jsdelivr.net/gh&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> Response.redirect(newUrl, <span class="number">302</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (path.search(exp3) === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> newUrl = path.replace(</span><br><span class="line">      <span class="regexp">/^(?:https?:\/\/)?github\.com/</span>,</span><br><span class="line">      <span class="string">&quot;https://github.com.cnpmjs.org&quot;</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> Response.redirect(newUrl, <span class="number">302</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (path.search(exp4) === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> newUrl = path</span><br><span class="line">      .replace(<span class="regexp">/(?&lt;=com\/.+?\/.+?)\/(.+?\/)/</span>, <span class="string">&quot;@$1&quot;</span>)</span><br><span class="line">      .replace(</span><br><span class="line">        <span class="regexp">/^(?:https?:\/\/)?raw\.githubusercontent\.com/</span>,</span><br><span class="line">        <span class="string">&quot;https://cdn.jsdelivr.net/gh&quot;</span></span><br><span class="line">      );</span><br><span class="line">    <span class="keyword">return</span> Response.redirect(newUrl, <span class="number">302</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fetch(ASSET_URL + path);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Request&#125;</span> <span class="variable">req</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">pathname</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">httpHandler</span>(<span class="params">req, pathname</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> reqHdrRaw = req.headers;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// preflight</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    req.method === <span class="string">&quot;OPTIONS&quot;</span> &amp;&amp;</span><br><span class="line">    reqHdrRaw.has(<span class="string">&quot;access-control-request-headers&quot;</span>)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Response(<span class="literal">null</span>, PREFLIGHT_INIT);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> rawLen = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> reqHdrNew = <span class="keyword">new</span> Headers(reqHdrRaw);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> urlStr = pathname;</span><br><span class="line">  <span class="keyword">if</span> (urlStr.startsWith(<span class="string">&quot;github&quot;</span>)) &#123;</span><br><span class="line">    urlStr = <span class="string">&quot;https://&quot;</span> + urlStr;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> urlObj = newUrl(urlStr);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** <span class="doctag">@type <span class="type">&#123;RequestInit&#125;</span> </span>*/</span></span><br><span class="line">  <span class="keyword">const</span> reqInit = &#123;</span><br><span class="line">    <span class="attr">method</span>: req.method,</span><br><span class="line">    <span class="attr">headers</span>: reqHdrNew,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&quot;follow&quot;</span>,</span><br><span class="line">    <span class="attr">body</span>: req.body,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> proxy(urlObj, reqInit, rawLen, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;URL&#125;</span> <span class="variable">urlObj</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;RequestInit&#125;</span> <span class="variable">reqInit</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">proxy</span>(<span class="params">urlObj, reqInit, rawLen</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> fetch(urlObj.href, reqInit);</span><br><span class="line">  <span class="keyword">const</span> resHdrOld = res.headers;</span><br><span class="line">  <span class="keyword">const</span> resHdrNew = <span class="keyword">new</span> Headers(resHdrOld);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// verify</span></span><br><span class="line">  <span class="keyword">if</span> (rawLen) &#123;</span><br><span class="line">    <span class="keyword">const</span> newLen = resHdrOld.get(<span class="string">&quot;content-length&quot;</span>) || <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">const</span> badLen = rawLen !== newLen;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (badLen) &#123;</span><br><span class="line">      <span class="keyword">return</span> makeRes(res.body, <span class="number">400</span>, &#123;</span><br><span class="line">        <span class="string">&quot;--error&quot;</span>: <span class="string">`bad len: <span class="subst">$&#123;newLen&#125;</span>, except: <span class="subst">$&#123;rawLen&#125;</span>`</span>,</span><br><span class="line">        <span class="string">&quot;access-control-expose-headers&quot;</span>: <span class="string">&quot;--error&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> status = res.status;</span><br><span class="line">  resHdrNew.set(<span class="string">&quot;access-control-expose-headers&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">  resHdrNew.set(<span class="string">&quot;access-control-allow-origin&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line"></span><br><span class="line">  resHdrNew.delete(<span class="string">&quot;content-security-policy&quot;</span>);</span><br><span class="line">  resHdrNew.delete(<span class="string">&quot;content-security-policy-report-only&quot;</span>);</span><br><span class="line">  resHdrNew.delete(<span class="string">&quot;clear-site-data&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Response(res.body, &#123;</span><br><span class="line">    status,</span><br><span class="line">    <span class="attr">headers</span>: resHdrNew,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†è¿™ä¸Šé¢çš„ä»£ç ç‰‡æ®µå¤åˆ¶ç²˜è´´åˆ° Workers é‡Œå°±å¯ä»¥å•¦ï¼ˆæ²¡é”™ï¼Œå°±æ˜¯é‚£ä¹ˆç®€å•ï¼‰</p><h1 id="ã€Œç¾åŒ–ã€">ã€Œç¾åŒ–ã€</h1><p>æˆ‘è§‰å¾—è¶Šæ¥çš„ç½‘é¡µæœ‰ç‚¹å¤æ‚ï¼Œå°±å¯¹å®ƒè¿›è¡Œäº†ä¸€ç‚¹ç‚¹çš„ç²¾ç®€/ç¾åŒ–</p><p>é¡ºä¾¿é€‚é…äº†ä¸‹æš—è‰²ä¸»é¢˜ï½</p><p>æŒ‰é’®é‚£è¾¹åŠ äº†ä¸ªèŠ±é‡Œèƒ¡å“¨çš„åŠ¨ç”»</p><p><img src="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/cloudflare-gh-proxy/white.png" class="lazy" data-srcset="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/cloudflare-gh-proxy/white.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAABlBMVEXMzMyWlpYU2uzLAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAACklEQVQImWNgAAAAAgAB9HFkpgAAAABJRU5ErkJggg==" alt="white"><br><img src="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/cloudflare-gh-proxy/dark.png" class="lazy" data-srcset="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/cloudflare-gh-proxy/dark.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAABlBMVEXMzMyWlpYU2uzLAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAACklEQVQImWNgAAAAAgAB9HFkpgAAAABJRU5ErkJggg==" alt="dark"></p><h1 id="åº”ç”¨">åº”ç”¨</h1><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="deletion">-const ASSET_URL = &#x27;https://hunshcn.github.io/gh-proxy&#x27;</span></span><br><span class="line"><span class="addition">+const ASSET_URL = &#x27;https://isteed.cc/gh&#x27;</span></span><br></pre></td></tr></table></figure><p>å°†ä¸Šé¢çš„ <code>ASSET_URL</code> åçš„ç½‘å€æ›¿æ¢æˆ <code>https://isteed.cc/gh</code> å°±å¥½äº†</p><h1 id="ç¢ç¢å¿µ">ç¢ç¢å¿µ</h1><p>GitHub ä½œä¸ºå…¨çƒæœ€å¤§çš„ä»£ç æ‰˜ç®¡å¹³å°ä¹‹ä¸€ï¼Œä½†ç”±äºç½‘ç»œç¯å¢ƒçš„é—®é¢˜ï¼Œå›½å†…ä¸‹è½½/è®¿é—®é€Ÿåº¦æ™®éåæ…¢ï¼ˆæˆ‘æ‰€åœ¨åœ°åŒºè¿˜æ— æ³•æ­£å¸¸è®¿é—® <code>raw.githubusercontent.com</code></p><p>å¥½äº†ï¼Œæ°´å®Œä¸€ç¯‡äº†ï½</p></article><blockquote class="post-license"><p><strong>æœ¬æ–‡ä½œè€…&nbsp;:&nbsp;Lufs</strong><br><strong>æœ¬æ–‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½å’Œå¼•ç”¨æ—¶è¯·æ³¨æ„éµå®ˆåè®®ï¼</strong><br><strong>æœ¬æ–‡é“¾æ¥&nbsp;:&nbsp;</strong><a href="https://blog.isteed.cc/post/cloudflare-gh-proxy/">https://blog.isteed.cc/post/cloudflare-gh-proxy/</a></p></blockquote><blockquote id="date-expire-notification" class="post-expired-notify">æœ¬æ–‡æœ€åæ›´æ–°äº <span id="date-expire-num"></span> å¤©å‰ï¼Œæ–‡ä¸­æ‰€æè¿°çš„ä¿¡æ¯å¯èƒ½å·²å‘ç”Ÿæ”¹å˜</blockquote><script>!function(){var e=Date.parse("2020-05-09"),t=(new Date).getTime(),e=Math.floor((t-e)/864e5);120<=e?document.getElementById("date-expire-num").innerHTML=e:document.getElementById("date-expire-notification").style.display="none"}()</script><p class="post-footer-info mb-0 pt-0">æœ¬æ–‡å‘è¡¨äº&nbsp;<time datetime="2020-05-09T09:03:04.000Z" itemprop="datePublished">2020-05-09</time></p><p class="post-footer-info mb-0 pt-2"><span class="post-categories-list mt-2"><a class="post-categories-list-item" href="/categories/%E6%97%A5%E5%B8%B8/">æ—¥å¸¸</a> <a class="post-categories-list-item" href="/categories/%E6%97%A5%E5%B8%B8/%E5%88%86%E4%BA%AB/">åˆ†äº«</a> </span><span class="post-tags-list mt-2"><a class="post-tags-list-item" href="/tags/%E6%B0%B4/" rel="tag">#&nbsp;æ°´</a> <a class="post-tags-list-item" href="/tags/Cloudflare/" rel="tag">#&nbsp;Cloudflare</a> <a class="post-tags-list-item" href="/tags/GitHub/" rel="tag">#&nbsp;GitHub</a> <a class="post-tags-list-item" href="/tags/Proxy/" rel="tag">#&nbsp;Proxy</a></span></p></div><div class="post-nav px-2 bg-gray"><ul class="pagination"><li class="page-item page-prev"><a href="/post/xiaomi-65w-gan/" rel="prev"><div class="page-item-title"><i class="icon icon-back" aria-hidden="true"></i></div><div class="page-item-subtitle">å°èº«æï¼Œå¤§èƒ½é‡ â€”â€” è¿Ÿæ¥çš„å°ç±³ GaN å……ç”µå™¨ 65W å¼€ç®±ï¼ˆå’Œä¸€äº›ç®€å•çš„ä½“éªŒ</div></a></li><li class="page-item page-next"><a href="/post/vercel-github-pages/" rel="next"><div class="page-item-title"><i class="icon icon-forward" aria-hidden="true"></i></div><div class="page-item-subtitle">Now.sh ä¸ GitHub Pages çš„åŒçº¿éƒ¨ç½²</div></a></li></ul></div><div class="card-footer post-comment"><div id="disqus_thread"></div><script id="js-disqusjs" src="https://cdn.jsdelivr.net/npm/disqusjs@1.3.0/dist/disqus.js" async></script><script>document.getElementById("js-disqusjs").addEventListener("load",function(){function e(){new DisqusJS({shortname:"lufss-blog",siteName:"Lufs&#39;s Blog",identifier:"https://blog.isteed.cc/post/cloudflare-gh-proxy/",url:"https://blog.isteed.cc/post/cloudflare-gh-proxy/",api:"https://disqus.isteed.cc/",apikey:"f8sCuFyS82pto94gZ0V4xtPbYZlLej6xVCTPNyZ0CXlfZz25L8lqsnsxYVCPDhzc",admin:"Lufs_x"})}"complete"===document.readyState?e():window.addEventListener("load",e)})</script></div></div></div></div></div><footer class="text-center"><p class="footer-copyright mb-0">Copyright&nbsp;Â©&nbsp;<span id="copyright-year"></span> <a class="footer-copyright-a" href="https://blog.isteed.cc">Lufs's Blog</a></p><p class="footer-text mb-0"><a href="/atom.xml"><img src="https://cdn.jsdelivr.net/gh/lufsx/res@master/img/svg/subscribe-via-rss.svg"></a></p><p class="footer-develop mb-0">Powered by&nbsp;<a href="https://hexo.io" target="_blank" class="footer-develop-a" rel="external nofollow noopener noreferrer">Hexo</a><span class="footer-develop-divider"></span>Theme&nbsp;-&nbsp;<a href="https://github.com/SukkaW/hexo-theme-suka" target="_blank" class="footer-develop-a" rel="external noopener">Suka</a></p></footer><script>window.lazyLoadOptions={elements_selector:".lazy",threshold:50},function(){var e=(new Date).getFullYear(),o=document.getElementById("copyright-year");o.textContent=2018===e?e:"2018 - "+e}(),console.log("\n %c Suka Theme (hexo-theme-suka) | Â© SukkaW | Verision 1.3.3 %c https://github.com/SukkaW/hexo-theme-suka \n","color: #fff; background: #444; padding:5px 0;","background: #bbb; padding:5px 0;")</script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@16.1.0/dist/lazyload.iife.min.js" async></script><script>window.post_views_api="https://api.isteed.cc/api/ga"</script><script src="https://cdn.jsdelivr.net/gh/lufsx/res@0.2.2/file/ga-views.js"></script></body></html>